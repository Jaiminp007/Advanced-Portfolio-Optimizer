<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Portfolio Theory Optimizer</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Plotly.js CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e293b 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        .loading-spinner {
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen">
    
    <!-- Header -->
    <header class="gradient-bg py-6 px-4 shadow-lg">
        <div class="container mx-auto max-w-7xl">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">
                <i data-lucide="trending-up" class="inline-block w-8 h-8 mr-2 mb-1"></i>
                Modern Portfolio Theory Optimizer
            </h1>
            <p class="text-blue-200 text-sm md:text-base">An Interactive Tool for Visualizing the Efficient Frontier</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto max-w-7xl px-4 py-8">
        
        <!-- Input Section -->
        <div class="bg-gray-800 rounded-lg p-6 mb-8 card-shadow">
            <label for="tickerInput" class="block text-lg font-semibold mb-3 text-gray-100">
                <i data-lucide="list" class="inline-block w-5 h-5 mr-2"></i>
                Enter Stock Tickers (comma-separated)
            </label>
            <div class="flex flex-col sm:flex-row gap-3">
                <input 
                    type="text" 
                    id="tickerInput" 
                    value="AAPL, MSFT, GOOG, AMZN, TSLA"
                    class="flex-1 px-4 py-3 bg-gray-700 text-gray-100 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="e.g., AAPL, MSFT, GOOG"
                />
                <button 
                    id="calculateBtn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition duration-200 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl"
                >
                    <i data-lucide="calculator" class="w-5 h-5"></i>
                    Calculate Optimal Portfolio
                </button>
            </div>
            <div id="errorMessage" class="mt-3 text-red-400 text-sm hidden"></div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Left Column - Results Summary (1/3 width on large screens) -->
                <div class="lg:col-span-1">
                    <div class="bg-gray-800 rounded-lg p-6 card-shadow h-full">
                        <h2 class="text-xl font-bold mb-4 text-blue-400 flex items-center">
                            <i data-lucide="trophy" class="w-6 h-6 mr-2"></i>
                            Optimal Portfolio
                        </h2>
                        <p class="text-sm text-gray-400 mb-6">Maximum Sharpe Ratio</p>
                        
                        <!-- Key Metrics -->
                        <div class="space-y-4 mb-6">
                            <div class="bg-gray-700 rounded-lg p-4">
                                <p class="text-xs text-gray-400 mb-1">Expected Annual Return</p>
                                <p id="optimalReturn" class="text-2xl font-bold text-green-400">--</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <p class="text-xs text-gray-400 mb-1">Annual Volatility (Risk)</p>
                                <p id="optimalVolatility" class="text-2xl font-bold text-yellow-400">--</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <p class="text-xs text-gray-400 mb-1">Sharpe Ratio</p>
                                <p id="optimalSharpe" class="text-2xl font-bold text-blue-400">--</p>
                            </div>
                        </div>
                        
                        <!-- Optimal Weights -->
                        <div>
                            <h3 class="text-lg font-semibold mb-3 text-gray-100 flex items-center">
                                <i data-lucide="pie-chart" class="w-5 h-5 mr-2"></i>
                                Optimal Weights
                            </h3>
                            <div id="optimalWeights" class="space-y-2">
                                <!-- Weights will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column - Chart (2/3 width on large screens) -->
                <div class="lg:col-span-2">
                    <div class="bg-gray-800 rounded-lg p-6 card-shadow">
                        <h2 class="text-xl font-bold mb-4 text-blue-400 flex items-center">
                            <i data-lucide="bar-chart-3" class="w-6 h-6 mr-2"></i>
                            Efficient Frontier
                        </h2>
                        <div id="chartContainer" class="w-full" style="height: 600px;">
                            <!-- Plotly chart will be rendered here -->
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-gray-800 rounded-lg p-6 card-shadow flex items-center gap-4">
                <div class="loading-spinner"></div>
                <span class="text-lg">Optimizing portfolio...</span>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="container mx-auto max-w-7xl px-4 py-6 mt-12 text-center text-gray-500 text-sm">
        <p>Built with Modern Portfolio Theory â€¢ Monte Carlo Simulation with 10,000 iterations</p>
    </footer>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Mock historical price data (252 trading days - approximately 1 year)
        // Data represents adjusted close prices for demonstration purposes
        const mockPriceData = {
            'AAPL': [170.15, 171.23, 170.50, 172.45, 173.20, 171.80, 172.90, 174.25, 173.50, 175.10, 176.35, 175.20, 177.45, 178.90, 177.30, 179.50, 180.25, 181.40, 180.15, 182.30, 183.55, 182.10, 184.20, 185.45, 186.70, 185.30, 187.15, 188.90, 187.45, 189.70, 191.25, 190.10, 192.35, 193.80, 192.45, 194.60, 195.90, 194.25, 196.45, 197.80, 196.30, 198.55, 199.90, 198.45, 200.70, 202.15, 200.80, 203.25, 204.60, 203.15, 205.40, 206.85, 205.50, 207.75, 209.20, 207.85, 210.10, 211.55, 210.20, 212.45, 213.90, 212.55, 214.80, 216.25, 214.90, 217.15, 218.60, 217.25, 219.50, 220.95, 219.60, 221.85, 223.30, 221.95, 224.20, 225.65, 224.30, 226.55, 228.00, 226.65, 228.90, 230.35, 229.00, 231.25, 232.70, 231.35, 233.60, 235.05, 233.70, 235.95, 237.40, 236.05, 238.30, 239.75, 238.40, 240.65, 242.10, 240.75, 243.00, 244.45, 178.25, 179.80, 178.35, 180.60, 182.05, 180.70, 182.95, 184.40, 183.05, 185.30, 186.75, 185.40, 187.65, 189.10, 187.75, 190.00, 191.45, 190.10, 192.35, 193.80, 192.45, 194.70, 196.15, 194.80, 197.05, 198.50, 197.15, 199.40, 200.85, 199.50, 201.75, 203.20, 201.85, 204.10, 205.55, 204.20, 206.45, 207.90, 206.55, 208.80, 210.25, 208.90, 211.15, 212.60, 211.25, 213.50, 214.95, 213.60, 215.85, 217.30, 215.95, 218.20, 219.65, 218.30, 220.55, 222.00, 220.65, 222.90, 224.35, 223.00, 225.25, 226.70, 225.35, 227.60, 229.05, 227.70, 229.95, 231.40, 230.05, 232.30, 233.75, 232.40, 234.65, 236.10, 234.75, 237.00, 238.45, 237.10, 239.35, 240.80, 239.45, 241.70, 243.15, 241.80, 244.05, 245.50, 244.15, 246.40, 247.85, 246.50, 248.75, 250.20, 248.85, 251.10, 252.55, 251.20, 253.45, 254.90, 253.55, 255.80, 257.25, 255.90, 258.15, 259.60, 258.25, 260.50, 261.95, 260.60, 262.85, 264.30, 262.95, 265.20, 266.65, 265.30, 267.55, 269.00, 267.65, 269.90, 271.35, 270.00, 272.25, 273.70, 272.35, 274.60, 276.05, 274.70, 276.95, 278.40, 277.05, 279.30, 280.75, 279.40, 281.65, 283.10, 281.75, 284.00, 285.45, 284.10, 286.35, 287.80, 286.45, 288.70, 290.15],
            'MSFT': [300.80, 301.50, 302.75, 301.20, 303.45, 304.90, 303.55, 305.80, 307.25, 305.90, 308.15, 309.60, 308.25, 310.50, 311.95, 310.60, 312.85, 314.30, 312.95, 315.20, 316.65, 315.30, 317.55, 319.00, 317.65, 319.90, 321.35, 320.00, 322.25, 323.70, 322.35, 324.60, 326.05, 324.70, 326.95, 328.40, 327.05, 329.30, 330.75, 329.40, 331.65, 333.10, 331.75, 334.00, 335.45, 334.10, 336.35, 337.80, 336.45, 338.70, 340.15, 338.80, 341.05, 342.50, 341.15, 343.40, 344.85, 343.50, 345.75, 347.20, 345.85, 348.10, 349.55, 348.20, 350.45, 351.90, 350.55, 352.80, 354.25, 352.90, 355.15, 356.60, 355.25, 357.50, 358.95, 357.60, 359.85, 361.30, 359.95, 362.20, 363.65, 362.30, 364.55, 366.00, 364.65, 366.90, 368.35, 367.00, 369.25, 370.70, 369.35, 371.60, 373.05, 371.70, 373.95, 375.40, 374.05, 376.30, 377.75, 376.40, 315.20, 316.80, 315.35, 317.60, 319.05, 317.70, 319.95, 321.40, 320.05, 322.30, 323.75, 322.40, 324.65, 326.10, 324.75, 327.00, 328.45, 327.10, 329.35, 330.80, 329.45, 331.70, 333.15, 331.80, 334.05, 335.50, 334.15, 336.40, 337.85, 336.50, 338.75, 340.20, 338.85, 341.10, 342.55, 341.20, 343.45, 344.90, 343.55, 345.80, 347.25, 345.90, 348.15, 349.60, 348.25, 350.50, 351.95, 350.60, 352.85, 354.30, 352.95, 355.20, 356.65, 355.30, 357.55, 359.00, 357.65, 359.90, 361.35, 360.00, 362.25, 363.70, 362.35, 364.60, 366.05, 364.70, 366.95, 368.40, 367.05, 369.30, 370.75, 369.40, 371.65, 373.10, 371.75, 374.00, 375.45, 374.10, 376.35, 377.80, 376.45, 378.70, 380.15, 378.80, 381.05, 382.50, 381.15, 383.40, 384.85, 383.50, 385.75, 387.20, 385.85, 388.10, 389.55, 388.20, 390.45, 391.90, 390.55, 392.80, 394.25, 392.90, 395.15, 396.60, 395.25, 397.50, 398.95, 397.60, 399.85, 401.30, 399.95, 402.20, 403.65, 402.30, 404.55, 406.00, 404.65, 406.90, 408.35, 407.00, 409.25, 410.70, 409.35, 411.60, 413.05, 411.70, 413.95, 415.40, 414.05, 416.30, 417.75, 416.40, 418.65, 420.10],
            'GOOG': [135.20, 136.00, 135.90, 137.25, 138.40, 137.15, 139.30, 140.55, 139.20, 141.45, 142.80, 141.35, 143.60, 144.95, 143.50, 145.75, 147.10, 145.65, 147.90, 149.25, 147.80, 150.05, 151.40, 149.95, 152.20, 153.55, 152.10, 154.35, 155.70, 154.25, 156.50, 157.85, 156.40, 158.65, 160.00, 158.55, 160.80, 162.15, 160.70, 162.95, 164.30, 162.85, 165.10, 166.45, 165.00, 167.25, 168.60, 167.15, 169.40, 170.75, 169.30, 171.55, 172.90, 171.45, 173.70, 175.05, 173.60, 175.85, 177.20, 175.75, 178.00, 179.35, 177.90, 180.15, 181.50, 180.05, 182.30, 183.65, 182.20, 184.45, 185.80, 184.35, 186.60, 187.95, 186.50, 188.75, 190.10, 188.65, 190.90, 192.25, 190.80, 193.05, 194.40, 192.95, 195.20, 196.55, 195.10, 197.35, 198.70, 197.25, 199.50, 200.85, 199.40, 201.65, 203.00, 201.55, 203.80, 205.15, 203.70, 140.25, 141.60, 140.15, 142.40, 143.75, 142.30, 144.55, 145.90, 144.45, 146.70, 148.05, 146.60, 148.85, 150.20, 148.75, 151.00, 152.35, 150.90, 153.15, 154.50, 153.05, 155.30, 156.65, 155.20, 157.45, 158.80, 157.35, 159.60, 160.95, 159.50, 161.75, 163.10, 161.65, 163.90, 165.25, 163.80, 166.05, 167.40, 165.95, 168.20, 169.55, 168.10, 170.35, 171.70, 170.25, 172.50, 173.85, 172.40, 174.65, 176.00, 174.55, 176.80, 178.15, 176.70, 178.95, 180.30, 178.85, 181.10, 182.45, 181.00, 183.25, 184.60, 183.15, 185.40, 186.75, 185.30, 187.55, 188.90, 187.45, 189.70, 191.05, 189.60, 191.85, 193.20, 191.75, 194.00, 195.35, 193.90, 196.15, 197.50, 196.05, 198.30, 199.65, 198.20, 200.45, 201.80, 200.35, 202.60, 203.95, 202.50, 204.75, 206.10, 204.65, 206.90, 208.25, 206.80, 209.05, 210.40, 208.95, 211.20, 212.55, 211.10, 213.35, 214.70, 213.25, 215.50, 216.85, 215.40, 217.65, 219.00, 217.55, 219.80, 221.15, 219.70, 221.95, 223.30, 221.85, 224.10, 225.45, 224.00, 226.25, 227.60, 226.15, 228.40, 229.75, 228.30, 230.55, 231.90, 230.45, 232.70, 234.05, 232.60, 234.85, 236.20],
            'AMZN': [145.50, 146.80, 145.35, 147.60, 148.95, 147.50, 149.75, 151.10, 149.65, 151.90, 153.25, 151.80, 154.05, 155.40, 153.95, 156.20, 157.55, 156.10, 158.35, 159.70, 158.25, 160.50, 161.85, 160.40, 162.65, 164.00, 162.55, 164.80, 166.15, 164.70, 166.95, 168.30, 166.85, 169.10, 170.45, 169.00, 171.25, 172.60, 171.15, 173.40, 174.75, 173.30, 175.55, 176.90, 175.45, 177.70, 179.05, 177.60, 179.85, 181.20, 179.75, 182.00, 183.35, 181.90, 184.15, 185.50, 184.05, 186.30, 187.65, 186.20, 188.45, 189.80, 188.35, 190.60, 191.95, 190.50, 192.75, 194.10, 192.65, 194.90, 196.25, 194.80, 197.05, 198.40, 196.95, 199.20, 200.55, 199.10, 201.35, 202.70, 201.25, 203.50, 204.85, 203.40, 205.65, 207.00, 205.55, 207.80, 209.15, 207.70, 209.95, 211.30, 209.85, 212.10, 213.45, 212.00, 214.25, 215.60, 214.15, 148.80, 150.25, 148.80, 151.05, 152.40, 150.95, 153.20, 154.55, 153.10, 155.35, 156.70, 155.25, 157.50, 158.85, 157.40, 159.65, 161.00, 159.55, 161.80, 163.15, 161.70, 163.95, 165.30, 163.85, 166.10, 167.45, 166.00, 168.25, 169.60, 168.15, 170.40, 171.75, 170.30, 172.55, 173.90, 172.45, 174.70, 176.05, 174.60, 176.85, 178.20, 176.75, 179.00, 180.35, 178.90, 181.15, 182.50, 181.05, 183.30, 184.65, 183.20, 185.45, 186.80, 185.35, 187.60, 188.95, 187.50, 189.75, 191.10, 189.65, 191.90, 193.25, 191.80, 194.05, 195.40, 193.95, 196.20, 197.55, 196.10, 198.35, 199.70, 198.25, 200.50, 201.85, 200.40, 202.65, 204.00, 202.55, 204.80, 206.15, 204.70, 206.95, 208.30, 206.85, 209.10, 210.45, 209.00, 211.25, 212.60, 211.15, 213.40, 214.75, 213.30, 215.55, 216.90, 215.45, 217.70, 219.05, 217.60, 219.85, 221.20, 219.75, 222.00, 223.35, 221.90, 224.15, 225.50, 224.05, 226.30, 227.65, 226.20, 228.45, 229.80, 228.35, 230.60, 231.95, 230.50, 232.75, 234.10, 232.65, 234.90, 236.25, 234.80, 237.05, 238.40],
            'TSLA': [242.50, 245.80, 243.15, 248.30, 251.75, 247.90, 253.45, 257.20, 252.65, 258.90, 263.45, 258.10, 264.75, 269.30, 263.95, 270.60, 275.15, 269.80, 276.45, 281.00, 275.65, 282.30, 286.85, 281.50, 288.15, 292.70, 287.35, 294.00, 298.55, 293.20, 299.85, 304.40, 299.05, 305.70, 310.25, 304.90, 311.55, 316.10, 310.75, 317.40, 321.95, 316.60, 323.25, 327.80, 322.45, 329.10, 333.65, 328.30, 334.95, 339.50, 334.15, 340.80, 345.35, 340.00, 346.65, 351.20, 345.85, 352.50, 357.05, 351.70, 358.35, 362.90, 357.55, 364.20, 368.75, 363.40, 370.05, 374.60, 369.25, 375.90, 380.45, 375.10, 381.75, 386.30, 380.95, 387.60, 392.15, 386.80, 393.45, 398.00, 392.65, 399.30, 403.85, 398.50, 405.15, 409.70, 404.35, 411.00, 415.55, 410.20, 416.85, 421.40, 416.05, 422.70, 427.25, 421.90, 428.55, 433.10, 427.75, 252.80, 257.45, 251.90, 258.55, 263.10, 257.75, 264.40, 268.95, 263.60, 270.25, 274.80, 269.45, 276.10, 280.65, 275.30, 281.95, 286.50, 281.15, 287.80, 292.35, 287.00, 293.65, 298.20, 292.85, 299.50, 304.05, 298.70, 305.35, 309.90, 304.55, 311.20, 315.75, 310.40, 317.05, 321.60, 316.25, 322.90, 327.45, 322.10, 328.75, 333.30, 327.95, 334.60, 339.15, 333.80, 340.45, 345.00, 339.65, 346.30, 350.85, 345.50, 352.15, 356.70, 351.35, 358.00, 362.55, 357.20, 363.85, 368.40, 363.05, 369.70, 374.25, 368.90, 375.55, 380.10, 374.75, 381.40, 385.95, 380.60, 387.25, 391.80, 386.45, 393.10, 397.65, 392.30, 398.95, 403.50, 398.15, 404.80, 409.35, 404.00, 410.65, 415.20, 409.85, 416.50, 421.05, 415.70, 422.35, 426.90, 421.55, 428.20, 432.75, 427.40, 434.05, 438.60, 433.25, 439.90, 444.45, 439.10, 445.75, 450.30, 444.95, 451.60, 456.15, 450.80, 457.45, 462.00, 456.65, 463.30, 467.85, 462.50, 469.15, 473.70],
            'NVDA': [485.20, 490.75, 483.40, 496.30, 503.85, 492.50, 509.40, 517.95, 505.60, 523.50, 532.05, 518.70, 537.60, 546.15, 532.80, 551.70, 560.25, 546.90, 565.80, 574.35, 561.00, 579.90, 588.45, 575.10, 594.00, 602.55, 589.20, 608.10, 616.65, 603.30, 622.20, 630.75, 617.40, 636.30, 644.85, 631.50, 650.40, 658.95, 645.60, 664.50, 673.05, 659.70, 678.60, 687.15, 673.80, 692.70, 701.25, 687.90, 706.80, 715.35, 702.00, 720.90, 729.45, 716.10, 735.00, 743.55, 730.20, 749.10, 757.65, 744.30, 763.20, 771.75, 758.40, 777.30, 785.85, 772.50, 791.40, 799.95, 786.60, 805.50, 814.05, 800.70, 819.60, 828.15, 814.80, 833.70, 842.25, 828.90, 847.80, 856.35, 843.00, 861.90, 870.45, 857.10, 876.00, 884.55, 871.20, 890.10, 898.65, 885.30, 904.20, 912.75, 899.40, 918.30, 926.85, 913.50, 932.40, 940.95, 927.60, 495.50, 504.25, 491.80, 510.55, 519.30, 506.85, 525.60, 534.35, 521.90, 540.65, 549.40, 536.95, 555.70, 564.45, 552.00, 570.75, 579.50, 567.05, 585.80, 594.55, 582.10, 600.85, 609.60, 597.15, 615.90, 624.65, 612.20, 630.95, 639.70, 627.25, 646.00, 654.75, 642.30, 661.05, 669.80, 657.35, 676.10, 684.85, 672.40, 691.15, 699.90, 687.45, 706.20, 714.95, 702.50, 721.25, 730.00, 717.55, 736.30, 745.05, 732.60, 751.35, 760.10, 747.65, 766.40, 775.15, 762.70, 781.45, 790.20, 777.75, 796.50, 805.25, 792.80, 811.55, 820.30, 807.85, 826.60, 835.35, 822.90, 841.65, 850.40, 837.95, 856.70, 865.45, 853.00, 871.75, 880.50, 868.05, 886.80, 895.55, 883.10, 901.85, 910.60, 898.15, 916.90, 925.65, 913.20, 931.95, 940.70, 928.25, 947.00, 955.75, 943.30, 962.05, 970.80, 958.35, 977.10, 985.85, 973.40, 992.15, 1000.90, 988.45, 1007.20, 1015.95, 1003.50, 1022.25, 1031.00, 1018.55, 1037.30, 1046.05, 1033.60, 1052.35, 1061.10, 1048.65, 1067.40, 1076.15],
            'JPM': [145.30, 146.85, 144.75, 148.40, 150.95, 147.85, 151.50, 154.05, 150.95, 154.60, 157.15, 154.05, 157.70, 160.25, 157.15, 160.80, 163.35, 160.25, 163.90, 166.45, 163.35, 167.00, 169.55, 166.45, 170.10, 172.65, 169.55, 173.20, 175.75, 172.65, 176.30, 178.85, 175.75, 179.40, 181.95, 178.85, 182.50, 185.05, 181.95, 185.60, 188.15, 185.05, 188.70, 191.25, 188.15, 191.80, 194.35, 191.25, 194.90, 197.45, 194.35, 198.00, 200.55, 197.45, 201.10, 203.65, 200.55, 204.20, 206.75, 203.65, 207.30, 209.85, 206.75, 210.40, 212.95, 209.85, 213.50, 216.05, 212.95, 216.60, 219.15, 216.05, 219.70, 222.25, 219.15, 222.80, 225.35, 222.25, 225.90, 228.45, 225.35, 229.00, 231.55, 228.45, 232.10, 234.65, 231.55, 235.20, 237.75, 234.65, 238.30, 240.85, 237.75, 241.40, 243.95, 240.85, 244.50, 247.05, 243.95, 148.60, 151.25, 147.95, 151.60, 154.15, 151.05, 154.70, 157.25, 154.15, 157.80, 160.35, 157.25, 160.90, 163.45, 160.35, 164.00, 166.55, 163.45, 167.10, 169.65, 166.55, 170.20, 172.75, 169.65, 173.30, 175.85, 172.75, 176.40, 178.95, 175.85, 179.50, 182.05, 178.95, 182.60, 185.15, 182.05, 185.70, 188.25, 185.15, 188.80, 191.35, 188.25, 191.90, 194.45, 191.35, 195.00, 197.55, 194.45, 198.10, 200.65, 197.55, 201.20, 203.75, 200.65, 204.30, 206.85, 203.75, 207.40, 209.95, 206.85, 210.50, 213.05, 209.95, 213.60, 216.15, 213.05, 216.70, 219.25, 216.15, 219.80, 222.35, 219.25, 222.90, 225.45, 222.35, 226.00, 228.55, 225.45, 229.10, 231.65, 228.55, 232.20, 234.75, 231.65, 235.30, 237.85, 234.75, 238.40, 240.95, 237.85, 241.50, 244.05, 240.95, 244.60, 247.15, 244.05, 247.70, 250.25, 247.15, 250.80, 253.35, 250.25, 253.90, 256.45, 253.35, 257.00, 259.55, 256.45, 260.10, 262.65, 259.55, 263.20, 265.75, 262.65, 266.30, 268.85, 265.75, 269.40, 271.95, 268.85, 272.50, 275.05],
            'V': [235.40, 237.85, 234.95, 240.30, 243.75, 238.85, 244.20, 247.65, 242.75, 248.10, 251.55, 246.65, 252.00, 255.45, 250.55, 255.90, 259.35, 254.45, 259.80, 263.25, 258.35, 263.70, 267.15, 262.25, 267.60, 271.05, 266.15, 271.50, 274.95, 270.05, 275.40, 278.85, 273.95, 279.30, 282.75, 277.85, 283.20, 286.65, 281.75, 287.10, 290.55, 285.65, 291.00, 294.45, 289.55, 294.90, 298.35, 293.45, 298.80, 302.25, 297.35, 302.70, 306.15, 301.25, 306.60, 310.05, 305.15, 310.50, 313.95, 309.05, 314.40, 317.85, 312.95, 318.30, 321.75, 316.85, 322.20, 325.65, 320.75, 326.10, 329.55, 324.65, 330.00, 333.45, 328.55, 333.90, 337.35, 332.45, 337.80, 341.25, 336.35, 341.70, 345.15, 340.25, 345.60, 349.05, 344.15, 349.50, 352.95, 348.05, 353.40, 356.85, 351.95, 357.30, 360.75, 355.85, 361.20, 364.65, 359.75, 238.70, 242.25, 237.25, 242.60, 246.05, 241.15, 246.50, 249.95, 245.05, 250.40, 253.85, 248.95, 254.30, 257.75, 252.85, 258.20, 261.65, 256.75, 262.10, 265.55, 260.65, 266.00, 269.45, 264.55, 269.90, 273.35, 268.45, 273.80, 277.25, 272.35, 277.70, 281.15, 276.25, 281.60, 285.05, 280.15, 285.50, 288.95, 284.05, 289.40, 292.85, 287.95, 293.30, 296.75, 291.85, 297.20, 300.65, 295.75, 301.10, 304.55, 299.65, 305.00, 308.45, 303.55, 308.90, 312.35, 307.45, 312.80, 316.25, 311.35, 316.70, 320.15, 315.25, 320.60, 324.05, 319.15, 324.50, 327.95, 323.05, 328.40, 331.85, 326.95, 332.30, 335.75, 330.85, 336.20, 339.65, 334.75, 340.10, 343.55, 338.65, 344.00, 347.45, 342.55, 347.90, 351.35, 346.45, 351.80, 355.25, 350.35, 355.70, 359.15, 354.25, 359.60, 363.05, 358.15, 363.50, 366.95, 362.05, 367.40, 370.85, 365.95, 371.30, 374.75, 369.85, 375.20, 378.65, 373.75, 379.10, 382.55, 377.65, 383.00, 386.45, 381.55, 386.90, 390.35, 385.45, 390.80, 394.25, 389.35, 394.70, 398.15]
        };

        const riskFreeRate = 0.02; // 2% annual risk-free rate

        // DOM Elements
        const tickerInput = document.getElementById('tickerInput');
        const calculateBtn = document.getElementById('calculateBtn');
        const errorMessage = document.getElementById('errorMessage');
        const resultsSection = document.getElementById('resultsSection');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const optimalReturn = document.getElementById('optimalReturn');
        const optimalVolatility = document.getElementById('optimalVolatility');
        const optimalSharpe = document.getElementById('optimalSharpe');
        const optimalWeights = document.getElementById('optimalWeights');
        const chartContainer = document.getElementById('chartContainer');

        // Helper function to calculate logarithmic returns
        function calculateLogReturns(prices) {
            const returns = [];
            for (let i = 1; i < prices.length; i++) {
                returns.push(Math.log(prices[i] / prices[i - 1]));
            }
            return returns;
        }

        // Helper function to calculate mean of an array
        function mean(arr) {
            return arr.reduce((sum, val) => sum + val, 0) / arr.length;
        }

        // Helper function for matrix multiplication: vector^T * matrix * vector
        function quadraticForm(weights, covMatrix) {
            const n = weights.length;
            let result = 0;
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    result += weights[i] * covMatrix[i][j] * weights[j];
                }
            }
            return result;
        }

        // Helper function for dot product
        function dotProduct(arr1, arr2) {
            return arr1.reduce((sum, val, idx) => sum + val * arr2[idx], 0);
        }

        // Calculate covariance between two return arrays
        function covariance(returns1, returns2) {
            const mean1 = mean(returns1);
            const mean2 = mean(returns2);
            const n = returns1.length;
            let cov = 0;
            for (let i = 0; i < n; i++) {
                cov += (returns1[i] - mean1) * (returns2[i] - mean2);
            }
            return cov / (n - 1);
        }

        // Main calculation function
        function calculateOptimalPortfolio(tickers) {
            // Validate tickers
            const validTickers = tickers.filter(ticker => mockPriceData[ticker]);
            if (validTickers.length < 2) {
                throw new Error(`Insufficient valid tickers. Available tickers: ${Object.keys(mockPriceData).join(', ')}`);
            }

            // Calculate daily returns for each stock
            const returnsData = {};
            const meanReturns = [];
            
            validTickers.forEach(ticker => {
                const prices = mockPriceData[ticker];
                const returns = calculateLogReturns(prices);
                returnsData[ticker] = returns;
                // Annualize mean return (multiply by 252 trading days)
                meanReturns.push(mean(returns) * 252);
            });

            // Calculate covariance matrix (annualized)
            const n = validTickers.length;
            const covMatrix = Array(n).fill(0).map(() => Array(n).fill(0));
            
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    // Annualize covariance (multiply by 252)
                    covMatrix[i][j] = covariance(
                        returnsData[validTickers[i]], 
                        returnsData[validTickers[j]]
                    ) * 252;
                }
            }

            // Monte Carlo simulation - generate random portfolios
            const numSimulations = 10000;
            const portfolios = [];
            let maxSharpe = -Infinity;
            let optimalPortfolio = null;

            for (let sim = 0; sim < numSimulations; sim++) {
                // Generate random weights that sum to 1
                const rawWeights = Array(n).fill(0).map(() => Math.random());
                const sumWeights = rawWeights.reduce((sum, w) => sum + w, 0);
                const weights = rawWeights.map(w => w / sumWeights);

                // Calculate portfolio return
                const portfolioReturn = dotProduct(weights, meanReturns);

                // Calculate portfolio volatility (standard deviation)
                const portfolioVariance = quadraticForm(weights, covMatrix);
                const portfolioVolatility = Math.sqrt(portfolioVariance);

                // Calculate Sharpe ratio
                const sharpeRatio = (portfolioReturn - riskFreeRate) / portfolioVolatility;

                const portfolio = {
                    weights,
                    return: portfolioReturn,
                    volatility: portfolioVolatility,
                    sharpe: sharpeRatio
                };

                portfolios.push(portfolio);

                // Track optimal portfolio (highest Sharpe ratio)
                if (sharpeRatio > maxSharpe) {
                    maxSharpe = sharpeRatio;
                    optimalPortfolio = portfolio;
                }
            }

            return {
                portfolios,
                optimal: optimalPortfolio,
                tickers: validTickers
            };
        }

        // Display results on the page
        function displayResults(results) {
            const { portfolios, optimal, tickers } = results;

            // Display optimal portfolio metrics
            optimalReturn.textContent = `${(optimal.return * 100).toFixed(2)}%`;
            optimalVolatility.textContent = `${(optimal.volatility * 100).toFixed(2)}%`;
            optimalSharpe.textContent = optimal.sharpe.toFixed(3);

            // Display optimal weights
            optimalWeights.innerHTML = '';
            tickers.forEach((ticker, idx) => {
                const weight = optimal.weights[idx];
                const weightEl = document.createElement('div');
                weightEl.className = 'flex justify-between items-center bg-gray-700 rounded px-3 py-2';
                weightEl.innerHTML = `
                    <span class="font-medium">${ticker}</span>
                    <span class="text-blue-400 font-semibold">${(weight * 100).toFixed(2)}%</span>
                `;
                optimalWeights.appendChild(weightEl);
            });

            // Create scatter plot with Plotly
            const returns = portfolios.map(p => p.return * 100);
            const volatilities = portfolios.map(p => p.volatility * 100);
            const sharpes = portfolios.map(p => p.sharpe);

            const trace1 = {
                x: volatilities,
                y: returns,
                mode: 'markers',
                type: 'scatter',
                name: 'Simulated Portfolios',
                marker: {
                    size: 4,
                    color: sharpes,
                    colorscale: 'Viridis',
                    showscale: true,
                    colorbar: {
                        title: 'Sharpe<br>Ratio',
                        titlefont: { color: '#e5e7eb' },
                        tickfont: { color: '#e5e7eb' }
                    },
                    line: {
                        width: 0
                    }
                },
                hovertemplate: 
                    '<b>Return:</b> %{y:.2f}%<br>' +
                    '<b>Volatility:</b> %{x:.2f}%<br>' +
                    '<b>Sharpe:</b> %{marker.color:.3f}<br>' +
                    '<extra></extra>'
            };

            const trace2 = {
                x: [optimal.volatility * 100],
                y: [optimal.return * 100],
                mode: 'markers',
                type: 'scatter',
                name: 'Optimal Portfolio',
                marker: {
                    size: 15,
                    color: '#10b981',
                    symbol: 'star',
                    line: {
                        color: '#ffffff',
                        width: 2
                    }
                },
                hovertemplate: 
                    '<b>Optimal Portfolio</b><br>' +
                    '<b>Return:</b> %{y:.2f}%<br>' +
                    '<b>Volatility:</b> %{x:.2f}%<br>' +
                    '<b>Sharpe:</b> ' + optimal.sharpe.toFixed(3) + '<br>' +
                    '<extra></extra>'
            };

            const layout = {
                title: {
                    text: 'Monte Carlo Simulation (10,000 Portfolios)',
                    font: { color: '#e5e7eb', size: 16 }
                },
                xaxis: {
                    title: 'Annual Volatility (Risk) %',
                    color: '#e5e7eb',
                    gridcolor: '#374151'
                },
                yaxis: {
                    title: 'Expected Annual Return %',
                    color: '#e5e7eb',
                    gridcolor: '#374151'
                },
                paper_bgcolor: '#1f2937',
                plot_bgcolor: '#1f2937',
                hovermode: 'closest',
                showlegend: true,
                legend: {
                    font: { color: '#e5e7eb' },
                    bgcolor: 'rgba(31, 41, 55, 0.8)'
                }
            };

            const config = {
                responsive: true,
                displayModeBar: true,
                displaylogo: false
            };

            Plotly.newPlot(chartContainer, [trace1, trace2], layout, config);

            // Show results section
            resultsSection.classList.remove('hidden');
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }

        // Main calculation handler
        async function handleCalculate() {
            try {
                // Hide previous error and results
                errorMessage.classList.add('hidden');
                resultsSection.classList.add('hidden');

                // Parse tickers from input
                const input = tickerInput.value.trim();
                if (!input) {
                    showError('Please enter at least 2 stock tickers.');
                    return;
                }

                const tickers = input.split(',').map(t => t.trim().toUpperCase()).filter(t => t);
                
                if (tickers.length < 2) {
                    showError('Please enter at least 2 stock tickers.');
                    return;
                }

                // Show loading indicator
                loadingIndicator.classList.remove('hidden');
                calculateBtn.disabled = true;

                // Use setTimeout to allow UI to update before heavy calculation
                setTimeout(() => {
                    try {
                        const results = calculateOptimalPortfolio(tickers);
                        displayResults(results);
                    } catch (error) {
                        showError(error.message);
                    } finally {
                        loadingIndicator.classList.add('hidden');
                        calculateBtn.disabled = false;
                    }
                }, 100);

            } catch (error) {
                showError('An unexpected error occurred. Please try again.');
                console.error(error);
                loadingIndicator.classList.add('hidden');
                calculateBtn.disabled = false;
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            calculateBtn.addEventListener('click', handleCalculate);
            
            // Allow Enter key to trigger calculation
            tickerInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleCalculate();
                }
            });

            // Initialize icons
            lucide.createIcons();
        });
    </script>

</body>
</html>